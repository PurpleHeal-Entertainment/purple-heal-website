<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Perfil de artista - Purple Heal Entertainment">
    <title>Artista | Purple Heal Entertainment</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/reset.css?v=1.9">
    <link rel="stylesheet" href="css/variables.css?v=1.9">
    <link rel="stylesheet" href="css/global.css?v=1.9">
    <link rel="stylesheet" href="css/components.css?v=1.9">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/logos/PURPLE HEAL LOGO PURPURA.svg">

    <!-- Favicon -->
</head>

<body>
    <div class="site-wrapper">
        <!-- Navigation -->
        <nav class="ph-nav" id="navbar">
            <div class="container ph-nav__container">
                <a href="index.html">
                    <img src="assets/logos/PURPLE HEAL LOGO TEXTO BLANCO OPCION 2.svg" alt="Purple Heal Logo"
                        class="ph-nav__logo">
                </a>

                <div class="ph-nav__menu">
                    <a href="index.html" class="ph-nav__link">Inicio</a>
                    <a href="artists.html" class="ph-nav__link">Artistas</a>
                    <a href="tours.html" class="ph-nav__link">Tours</a>
                    <a href="shop.html" class="ph-nav__link" id="nav-shop" style="display: none;">Tienda</a>
                    <a href="about.html" class="ph-nav__link">Nosotros</a>
                </div>

                <div class="ph-nav__toggle" id="nav-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="ph-mobile-menu">
            <div class="ph-mobile-menu__content">
                <a href="index.html" class="ph-mobile-menu__link">Inicio</a>
                <a href="artists.html" class="ph-mobile-menu__link">Artistas</a>
                <a href="tours.html" class="ph-mobile-menu__link">Tours</a>
                <a href="shop.html" class="ph-mobile-menu__link" id="nav-shop-mobile" style="display: none;">Tienda</a>
                <a href="about.html" class="ph-mobile-menu__link">Nosotros</a>
            </div>
        </div>

        <!-- Artist Hero -->
        <section class="hero artist-hero">
            <div class="container">
                <div class="artist-hero-grid">
                    <!-- Artist Image -->
                    <div class="fade-in">
                        <img id="artist-image" src="" alt="Artist" class="artist-hero-image">
                    </div>

                    <!-- Artist Info -->
                    <div class="artist-info slide-in-right">
                        <p id="artist-genre" class="artist-info__genre">
                            <!-- Genre will be loaded dynamically -->
                        </p>
                        <h1 id="artist-name" class="artist-info__name">
                            <!-- Name will be loaded dynamically -->
                        </h1>
                        <p id="artist-bio" class="artist-info__bio">
                            <!-- Bio will be loaded dynamically -->
                        </p>

                        <!-- Streaming Links -->
                        <div class="artist-info__links">
                            <a href="#" class="ph-button ph-button--primary" id="spotifyBtn" style="display: none;"
                                target="_blank" rel="noopener noreferrer">
                                SPOTIFY
                            </a>
                            <a href="#" class="ph-button ph-button--outline" id="youtubeBtn" style="display: none;"
                                target="_blank" rel="noopener noreferrer">
                                YOUTUBE
                            </a>
                            <a href="#" class="ph-button ph-button--outline" id="appleMusicBtn" style="display: none;"
                                target="_blank" rel="noopener noreferrer">
                                APPLE MUSIC
                            </a>
                            <a href="#" class="ph-button ph-button--outline" id="instagramBtn" style="display: none;"
                                target="_blank" rel="noopener noreferrer">
                                INSTAGRAM
                            </a>
                            <a href="#" class="ph-button ph-button--outline" id="tiktokBtn" style="display: none;"
                                target="_blank" rel="noopener noreferrer">
                                TIKTOK
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Latest Video Section -->
        <section id="latestVideo" style="display: none; padding: var(--space-3xl) 0;">
            <div class="container">
                <h2 class="section-title" style="text-align: center; margin-bottom: var(--space-2xl);">
                    ULTIMO LANZAMIENTO
                </h2>
                <div class="video-container">
                    <iframe id="youtubePlayer" src="" title="YouTube video player" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                    </iframe>
                </div>
            </div>
        </section>

        <!-- Discography Section -->
        <section id="discography" style="padding: var(--space-4xl) 0;">
            <div class="container">
                <h2 class="text-center" style="margin-bottom: var(--space-2xl);">
                    DISCOGRAFIA
                </h2>
                <p class="text-center"
                    style="color: var(--ph-gray-lighter); max-width: 600px; margin: 0 auto var(--space-3xl);">
                    Explora los álbumes y sencillos que han marcado la carrera de este artista
                </p>

                <div class="slider-wrapper">
                    <button class="slider-btn slider-btn--left" id="prevAlbums" aria-label="Anterior">←</button>
                    <div class="horizontal-slider" id="albumsGrid">
                        <!-- Albums loaded dynamically from localStorage -->
                    </div>
                    <button class="slider-btn slider-btn--right" id="nextAlbums" aria-label="Siguiente">→</button>
                </div>
            </div>
        </section>

        <!-- Merchandise Section -->
        <section id="merch" style="background: rgba(0, 0, 0, 0.3); padding: var(--space-4xl) 0;">
            <div class="container">
                <h2 class="text-center" style="margin-bottom: var(--space-2xl);">
                    MERCHANDISING
                </h2>
                <p class="text-center"
                    style="color: var(--ph-gray-lighter); max-width: 600px; margin: 0 auto var(--space-3xl);">
                    Lleva tu amor por la música a otro nivel con mercancía oficial
                </p>

                <div class="slider-wrapper">
                    <button class="slider-btn slider-btn--left" id="prevMerch" aria-label="Anterior">←</button>
                    <div class="horizontal-slider" id="merchGrid">
                        <!-- Merch loaded dynamically from localStorage -->
                    </div>
                    <button class="slider-btn slider-btn--right" id="nextMerch" aria-label="Siguiente">→</button>
                </div>
            </div>
        </section>

        <!-- Back to Artists -->
        <section>
            <div class="container text-center">
                <a href="artists.html" class="ph-button ph-button--gold">← Ver Todos los Artistas</a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="ph-footer">
            <div class="container">
                <div class="ph-footer__content">
                    <div class="ph-footer__section">
                        <h3>Purple Heal Entertainment</h3>
                        <p style="color: var(--ph-gray-light); margin-top: var(--space-sm);">
                            Creando el futuro de la música, un artista a la vez.
                        </p>
                    </div>

                    <div class="ph-footer__section">
                        <h3>Enlaces Rapidos</h3>
                        <div class="ph-footer__links">
                            <a href="index.html" class="ph-footer__link">Home</a>
                            <a href="artists.html" class="ph-footer__link">Artistas</a>
                            <a href="index.html#about" class="ph-footer__link">Nosotros</a>
                            <a href="index.html#contact" class="ph-footer__link">Contacto</a>
                        </div>
                    </div>

                    <div class="ph-footer__section">
                        <h3>Siguenos</h3>
                        <div class="ph-footer__links">
                            <a href="https://www.instagram.com/purpleheal_ent/" class="ph-footer__link"
                                target="_blank">Instagram</a>
                            <a href="https://www.x.com/PURPLEHEAL" class="ph-footer__link" target="_blank">Twitter</a>
                            <a href="https://www.youtube.com/@purplehealent" class="ph-footer__link"
                                target="_blank">YouTube</a>
                        </div>
                    </div>
                </div>

                <div class="ph-footer__bottom">
                    <p>&copy; 2026 Purple Heal Entertainment. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/storage-db.js?v=2.1"></script>
    <script src="js/main.js?v=2.1"></script>
    <script src="js/artists-data.js?v=2"></script>
    <script src="js/product-loader.js?v=2.2"></script>
    <script>
        // Load artist data based on URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const artistId = parseInt(urlParams.get('artist') || '0');

        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // OPTIMIZATION: Fetch directly from Cloud with Cache Busting
                const REPO_OWNER = 'PurpleHeal-Entertainment';
                const REPO_NAME = 'purple-heal-website';
                const BRANCH = 'master';
                const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/data/artists.json?t=${Date.now()}`;

                console.log('☁️ Fetching artist profile from Cloud:', url);
                const response = await fetch(url);

                if (!response.ok) throw new Error('Network response was not ok');

                const artists = await response.json();
                const artist = artists[artistId];

                if (!artist) {
                    console.error('Artist not found');
                    document.querySelector('.artist-hero').innerHTML = '<div class="container text-center"><h1>Artista no encontrado</h1><a href="artists.html" class="ph-button ph-button--primary">Volver</a></div>';
                    return;
                }

                renderArtistProfile(artist);
                renderDiscography(artist);
                renderMerchandise(artist);

            } catch (error) {
                console.error('Error loading artist profile:', error);
                // Fallback to local DB if cloud fails (optional)
                try {
                    await initDB();
                    if (typeof loadArtistProfile === 'function') {
                        await loadArtistProfile(artistId);
                    }
                } catch (e) {
                    console.error('Fallback failed:', e);
                }
            }
        });

        function renderArtistProfile(artist) {
            // Update Meta Title
            document.title = `${artist.name} | Purple Heal Entertainment`;

            // Hero Section
            const img = document.getElementById('artist-image');
            img.src = artist.image || 'assets/placeholder-artist.jpg';
            img.alt = artist.name;

            document.getElementById('artist-genre').textContent = artist.genre || 'Género no definido';
            document.getElementById('artist-name').textContent = artist.name;
            document.getElementById('artist-bio').textContent = artist.bio || 'Biografía no disponible.';

            // Social Links
            const socials = artist.socials || {};
            const buttons = {
                spotify: document.getElementById('spotifyBtn'),
                youtube: document.getElementById('youtubeBtn'),
                appleMusic: document.getElementById('appleMusicBtn'),
                instagram: document.getElementById('instagramBtn'),
                tiktok: document.getElementById('tiktokBtn')
            };

            for (const [key, btn] of Object.entries(buttons)) {
                if (socials[key]) {
                    btn.href = socials[key];
                    btn.style.display = 'inline-flex';
                }
            }

            // Latest Video
            if (artist.latestVideoId) {
                const videoSection = document.getElementById('latestVideo');
                const iframe = document.getElementById('youtubePlayer');
                iframe.src = `https://www.youtube.com/embed/${artist.latestVideoId}`;
                videoSection.style.display = 'block';
            }
        }

        function renderDiscography(artist) {
            const container = document.getElementById('albumsGrid');
            if (!artist.albums || artist.albums.length === 0) {
                document.getElementById('discography').style.display = 'none';
                return;
            }

            container.innerHTML = artist.albums.map(album => `
                <div class="product-card">
                    <div class="product-card__image-container">
                        <img src="${album.images && album.images[0] ? album.images[0] : 'assets/placeholder-album.jpg'}" 
                             alt="${album.title}" class="product-card__image">
                    </div>
                    <div class="product-card__content">
                        <h3 class="product-card__title">${album.title}</h3>
                        <p class="product-card__price">$${album.price}</p>
                        <a href="${album.link || '#'}" class="product-card__button" target="_blank">
                            ${album.stock === 'SOLD OUT' ? 'AGOTADO' : 'COMPRAR / ESCUCHAR'}
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function renderMerchandise(artist) {
            const container = document.getElementById('merchGrid');
            if (!artist.merch || artist.merch.length === 0) {
                document.getElementById('merch').style.display = 'none';
                return;
            }

            container.innerHTML = artist.merch.map(product => `
                <div class="product-card">
                    <div class="product-card__image-container">
                        <img src="${product.images && product.images[0] ? product.images[0] : 'assets/placeholder-merch.jpg'}" 
                             alt="${product.name}" class="product-card__image">
                    </div>
                    <div class="product-card__content">
                        <h3 class="product-card__title">${product.name}</h3>
                        <p class="product-card__price">$${product.price}</p>
                        <a href="${product.link || '#'}" class="product-card__button" target="_blank">
                            ${product.stock === 'SOLD OUT' ? 'AGOTADO' : 'COMPRAR'}
                        </a>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>

</html>